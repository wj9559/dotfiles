#!/usr/bin/env bash

count=0
speed_less_then=${1:-30}
ERROR_count=${2:-10}
sleeptime=${3:-1}
average=3

_averageSpeed() {
    netspeed=0
    for i in $(seq $average); do
        let netspeed+=$(netspeed)
        sleep $sleeptime
    done
    let netspeed/=average
}

while [[ $count -lt $ERROR_count ]]; do
    _averageSpeed
    if [[ $netspeed -lt $speed_less_then ]]; then
        let count+=1
    fi
done

bell 2 60
notify-send --app-name=down --expire-time=0 "download is error"
exit 2
