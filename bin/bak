#!/usr/bin/env bash
# author: wujian(github.com/wj9559)

_usage(){
echo "Usage: bak [filename] ...
create file.bak, default exec \"$cpmv\".
  -mv           mv filename filename.bak
  -h, --help    display this help and exit"
}
[[ $1 == "-h" || $1 == "--help" ]] && _usage && exit

if [[ $1 == "-mv" ]]; then
    cpmv=mv
    shift
else
    cpmv="cp -a"
fi

_create(){
var=${1%/}
$cpmv $var{,.bak} &> /dev/null

if [[ $? -eq 0 ]]; then
	echo "create '$var.bak'"
else
	echo "bak: cannot access '$1': No such file or directory" >&2
	return 2
fi
}

exitcode=0
for file in $@; do
    _create $file
    [[ $? == 2 ]] && let exitcode++
done
[[ $exitcode -gt 0 ]] && exit 2 || exit 0
